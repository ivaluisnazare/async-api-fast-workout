#name: SonarCloud
#
#on:
#  pull_request:
#    branches:
#      - main
#      - release/**
#
#jobs:
#  sonarcloud:
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v4
#      with:
#        fetch-depth: 0
#
#    - name: Set up Python
#      uses: actions/setup-python@v4
#      with:
#        python-version: '3.12'
#
#    - name: Install dependencies
#      run: |
#        python -m pip install --upgrade pip
#        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
#        pip install pytest pytest-cov coverage
#
#    - name: Verify project structure
#      run: |
#        echo "Project structure:"
#        find . -name "*.py" | head -20
#        echo "Current directory:"
#        pwd
#
#    - name: Run tests with coverage
#      run: |
#        find . -name "*.py" -path "*/tests/*" -exec dirname {} \; | sort -u | xargs -I {} touch {}/__init__.py || true
#
#        python -m pytest \
#          --cov=./ \
#          --cov-config=pyproject.toml \
#          --cov-report=xml:coverage.xml \
#          --cov-report=term-missing \
#          --junitxml=test-results.xml \
#          -v
#
#    - name: Verify coverage data
#      run: |
#        echo "=== Coverage file exists? ==="
#        ls -la coverage.xml || echo "No coverage file"
#        echo "=== Coverage summary ==="
#        python -m coverage report -m
#        echo "=== Coverage XML first lines ==="
#        head -20 coverage.xml || echo "Cannot read coverage file"
#
#    - name: SonarCloud Scan
#      uses: SonarSource/sonarcloud-github-action@e2a1ee7c31ee491f1e09c74535b1c0d3e9f5cd82
#      env:
#        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#      with:
#        args: >
#          -Dsonar.python.version=3.12.3
#          -Dsonar.projectKey=ivaluisnazare_async-api-fast-dio-luizalabs
#          -Dsonar.projectName=async-api-fast-dio-luizalabs
#          -Dsonar.organization=ivaluisnazare
#          -Dsonar.projectVersion=1.0
#          -Dsonar.sources=account,shared
#          -Dsonar.sourceEncoding=UTF-8
#          -Dsonar.exclusions=**/tests/**,**/venv/**,**/.venv/**,**/__pycache__/**,**/.github/**,**/htmlcov/**
#          -Dsonar.tests=account/tests,shared/tests
#          -Dsonar.python.coverage.reportPaths=coverage.xml
#          -Dsonar.python.xunit.reportPath=test-results.xml
#          -Dsonar.coverage.exclusions=**/tests/**,**/venv/**,**/.venv/**,**/__pycache__/**,**/.github/**,**/htmlcov/**